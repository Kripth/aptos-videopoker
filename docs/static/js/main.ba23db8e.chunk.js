(this["webpackJsonpvideopoker-dapp"]=this["webpackJsonpvideopoker-dapp"]||[]).push([[0],{104:function(e){e.exports=JSON.parse('[{"address":"0x57c958c82e2b0ad77ff1aa63acad22a5f209951b","name":"BSC Testnet","unit":"BNB","coingecko":"binancecoin"},{"address":"0x41c356d798ea59edcf3eab146a8bec4c39155420","name":"Matic Testnet","unit":"MATIC","coingecko":"matic-network"}]')},196:function(e){e.exports=JSON.parse('[{"inputs":[],"name":"deposit","outputs":[],"stateMutability":"payable","type":"function"},{"inputs":[{"internalType":"uint256","name":"gameId","type":"uint256"},{"internalType":"uint256","name":"change","type":"uint256"}],"name":"end","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"kill","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"stateMutability":"payable","type":"constructor"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"uint256","name":"gameId","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"cards","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"result","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"payout","type":"uint256"}],"name":"End","type":"event"},{"inputs":[{"internalType":"uint256","name":"_risk","type":"uint256"}],"name":"setRisk","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"gameId","type":"uint256"}],"name":"start","outputs":[],"stateMutability":"payable","type":"function"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"uint256","name":"gameId","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"cards","type":"uint256"}],"name":"Start","type":"event"},{"inputs":[{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"withdraw","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"gameId","type":"uint256"}],"name":"getGame","outputs":[{"components":[{"internalType":"uint256","name":"bet","type":"uint256"},{"internalType":"address","name":"player","type":"address"},{"internalType":"uint64","name":"deck","type":"uint64"},{"internalType":"uint32","name":"cards","type":"uint32"}],"internalType":"struct Videopoker.Game","name":"","type":"tuple"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"player","type":"address"}],"name":"getGames","outputs":[{"internalType":"uint256[]","name":"","type":"uint256[]"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"getMaxBet","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"getMinBet","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"}]')},203:function(e,t,n){},216:function(e,t){},224:function(e,t){},242:function(e,t){},244:function(e,t){},260:function(e,t){},261:function(e,t){},325:function(e,t){},327:function(e,t){},359:function(e,t){},361:function(e,t){},362:function(e,t){},367:function(e,t){},369:function(e,t){},376:function(e,t){},389:function(e,t){},401:function(e,t){},404:function(e,t){},409:function(e,t){},414:function(e,t){},485:function(e,t,n){"use strict";n.r(t);var a=n(10),s=n.n(a),i=n(191),c=n.n(i),r=(n(203),n.p+"static/media/card.bad10dba.mp3"),l=n.p+"static/media/error.0c2f182b.mp3",u=n.p+"static/media/draw.d1037966.mp3",d=n.p+"static/media/loss.76807f79.mp3",o=n.p+"static/media/win.8edc9ff0.mp3";function b(e){const t=new Audio(e);return()=>{t.volume=1,t.currentTime=0,t.play()}}const p=b(r),j=b(l),m=b(u),h=b(d),f=b(o);var y=n(1);const x={9:"J",10:"Q",11:"K",12:"A"},O={0:"hearts",16:"diamonds",32:"clubs",48:"spades"};function w({index:e,value:t,flipped:n=!1}){const a=48&t,s=15&t,i=`card${e}`;return Object(y.jsxs)("div",{className:n?"card flipped":"card",children:[Object(y.jsx)("input",{id:i,type:"checkbox",name:i,onChange:p}),Object(y.jsxs)("label",{htmlFor:i,className:O[a],children:[Object(y.jsx)("span",{className:"value",children:x[s]||2+s}),Object(y.jsx)("span",{className:"suit"})]})]})}function v(e){return Array(5).fill().map(((t,n)=>{const a=6*n;return(e&63<<a)>>a}))}function g({cards:e}){return Object(y.jsx)("div",{className:"cards",children:v(e).map(((e,t)=>Object(y.jsx)(w,{index:t,value:e},t)))})}var N=n(192),S=n.n(N),M=n(196);const B=1000000000000000000n,I=["Jacks or better","Two pair","Three of a kind","Straight","Flush","Full house","Four of a kind","Straight flush","Royal flush"];function T(e,t=18){const n=e=>e.slice(0,t).replace(/0+$/,""),a=e.toString();if("0"===a)return a;if(a.length>18){const e=a.slice(0,-18),t=n(a.substr(a.length-18));return""===t?e:`${e}.${t}`}return`0.${n(a.padStart(18,"0"))}`}class k{constructor(e,t,n){this.web3=e,this.address=t,this.contract=n}call(e,...t){return this.contract.methods[e](...t).call({from:this.address})}send(e,t,...n){return this.contract.methods[e](...n).send({from:this.address,value:t.toString()})}event(e,t){const n=this.contract.events[e]({filter:{gameId:this.gameId}}).on("data",(e=>{t(e.returnValues),n.off("data")}))}async updateBalance(){return this.balance=BigInt(await this.web3.eth.getBalance(this.address))}async updateMin(){return this.min=BigInt(await this.call("getMinBet"))}async updateMax(){return this.max=BigInt(await this.call("getMaxBet"))}async getGasPrice(){return BigInt(await this.web3.eth.getGasPrice())}async getGame(e){const{bet:t,deck:n,cards:a}=await this.call("getGame",e);if(+n)return{id:e,playable:!0,bet:BigInt(t),cards:a};{const n=BigInt(t);return{id:e,result:Number(n>>252n),payout:n&2n**252n-1n,cards:a}}}getGames(){return this.call("getGames",this.address)}start(e){const t=this.gameId=function(){let e=0n;for(let t=0;t<8;t++)e|=BigInt(Math.floor(2147483648*Math.random()))<<BigInt(31*t);return e}();return new Promise(((n,a)=>{this.send("start",e,t).catch(a),this.event("Start",n)}))}end(e){return new Promise(((t,n)=>{this.send("end",0,this.gameId,e).catch(n),this.event("End",t)}))}}var $=n(104);function C({address:e,setError:t,setContract:n}){const[s,i]=Object(a.useState)(!0),[c,r]=Object(a.useState)(!1);async function l(e){const a=e.toLowerCase();t(null),n(null),r(!0);const s=await async function(e){const t=window.ethereum;if(t){const[n]=await window.ethereum.request({method:"eth_requestAccounts"}),a=new S.a(t),s=new a.eth.Contract(M,e);return new k(a,n,s)}}(a);if(s){window.contract=s,await Promise.all([s.updateBalance(),s.updateMin(),s.updateMax()]),i(!1);const e=n(s,$.find((e=>a===e.address))||{address:a});e instanceof Promise&&await e}else i(!0),t("Could not load contract");r(!1)}return Object(a.useEffect)((()=>{e&&l(e)}),[e]),Object(y.jsxs)("form",{className:"row force-margin",onSubmit:function(e){e.preventDefault(),l(new FormData(e.target).get("address"))},children:[Object(y.jsx)("label",{htmlFor:"input-contract",className:"label",children:"Contract"}),Object(y.jsxs)("div",{className:"value group",children:[Object(y.jsx)("input",{id:"input-contract",name:"address",defaultValue:e||$[0].address,spellCheck:!1}),Object(y.jsx)("button",{type:"submit",className:c?"loading":"",style:{width:"8rem"},children:s?"Use":"Change"})]})]})}function E({address:e="",page:t=1}){const[n,s]=Object(a.useState)(null),[i,c]=Object(a.useState)(""),[r,l]=Object(a.useState)(null),[u,d]=Object(a.useState)(null),[o,b]=Object(a.useState)(null);async function p(e,t,n){const a=5*t;b(await Promise.all(n.slice(a,a+5).map((t=>e.getGame(t)))))}return Object(a.useEffect)((()=>{n&&u&&p(n,t-1,u)}),[t]),Object(y.jsxs)(y.Fragment,{children:[Object(y.jsx)(C,{address:e,setError:console.warn,setContract:async function(e,n){if(e){const a=(await e.getGames()).slice().reverse();d(a),l(Math.ceil(a.length/5)),c(n.unit||""),await p(e,t-1,a),window.location.hash=`#history/${n.address}/${t}`}else b(null),d(null),c(null);s(e)}}),Object(y.jsxs)("div",{className:"row",children:[Object(y.jsx)("label",{id:"input-order",className:"label",children:"Order by"}),Object(y.jsx)("div",{className:"value",children:Object(y.jsxs)("select",{id:"input-order",disabled:!0,onChange:function(e){console.log(e)},children:[Object(y.jsx)("option",{value:"desc",children:"Newest"}),Object(y.jsx)("option",{value:"asc",children:"Oldest"})]})})]}),o&&Object(y.jsxs)(y.Fragment,{children:[Object(y.jsx)("div",{className:"row",children:Object(y.jsxs)("table",{className:"history",children:[Object(y.jsx)("thead",{children:Object(y.jsxs)("tr",{children:[Object(y.jsx)("th",{children:"Cards"}),Object(y.jsx)("th",{children:"Result"})]})}),Object(y.jsx)("tbody",{children:o.map((t=>Object(y.jsxs)("tr",{children:[Object(y.jsx)("td",{children:Object(y.jsx)("fieldset",{disabled:!0,children:Object(y.jsx)(g,{cards:t.cards})})}),Object(y.jsx)("td",{className:"result",children:t.playable?Object(y.jsx)("a",{href:`/#play/${e}/${t.id}`,children:Object(y.jsx)("button",{type:"button",children:"Resume"})}):t.result?Object(y.jsxs)(y.Fragment,{children:[Object(y.jsx)("div",{children:I[t.result-1]}),Object(y.jsxs)("div",{children:[T(t.payout,8)," ",i]})]}):""})]},t.id)))})]})}),Object(y.jsxs)("div",{className:"row history-footer",children:[Object(y.jsxs)("span",{children:["Page ",t," of ",r]}),Object(y.jsx)("div",{style:{flexGrow:1}}),Object(y.jsx)(F,{enabled:t>1&&r>1,href:`#history/${e}/${t-1}`,children:"Previous"}),Object(y.jsx)(F,{enabled:t<r,href:`#history/${e}/${+t+1}`,children:"Next"})]})]})]})}function F({enabled:e,href:t,children:n}){return e?Object(y.jsx)("a",{className:"nav",href:t,children:Object(y.jsx)("button",{children:n})}):Object(y.jsx)("button",{className:"nav",disabled:!0,children:n})}function G({address:e,resume:t}){const n=Object(a.useRef)(),[s,i]=Object(a.useState)(null),[c,r]=Object(a.useState)(!1),[l,u]=Object(a.useState)(!1),[d,o]=Object(a.useState)(""),[b,p]=Object(a.useState)(void 0),[x,O]=Object(a.useState)(null),[g,N]=Object(a.useState)([]),[S,M]=Object(a.useState)(null),[k,$]=Object(a.useState)(null);function E(e){return Promise.all([e.updateBalance().then((e=>(p(e),e))),e.updateMin(),e.updateMax()])}function F(){return E(s)}async function G(e){const t=function(e){const t=e.match(/^(0|[1-9]\d*)(?:\.(\d{1,18}))?$/);if(t)return t[2]?BigInt(t[1])*B+BigInt(t[2].padEnd(18,"0")):BigInt(e)*B;throw new SyntaxError("Invalid number")}(e.get("bet"));if(await F(),t>s.max)throw new Error("Bet too high");if(t<s.min)throw new Error("Bet too low");if(t>s.balance)throw new Error("Insufficient balance");{O(null),N([]),M(null);const{cards:e}=await s.start(t);O(e),p(b-t),r(!0),m()}}async function P(e){let t=0;const n=[];for(let s=0;s<5;s++)e.get("card"+s)||(t|=1<<s,n[s]=1);N(n);const{cards:a,result:i,payout:c}=await s.end(t).finally((()=>{N([])})),l=+i;l?(c>0&&p(b+BigInt(c)),M({index:l,payout:c}),f()):(M(null),h()),O(a),r(!1)}return Object(a.useEffect)((()=>{if(s){const e=setInterval(F,3e4);return()=>clearInterval(e)}}),[s]),Object(y.jsxs)(y.Fragment,{children:[Object(y.jsx)(C,{address:e,setError:$,setContract:async function(e,a){if(e){await E(e);const{unit:s,coingecko:i}=a;o(s||"");let c=e.balance/10n;if(c>e.max?c=e.max:c<e.min&&(c=e.min),n.current.value=T(c,5),window.location.hash=`#play/${a.address}`,t){const a=await e.getGame(t);a.playable&&(e.gameId=a.id,n.current.value=T(a.bet),O(a.cards),r(!0))}}else n.current.value="";i(e)}}),Object(y.jsx)("form",{onSubmit:async function(e){e.preventDefault(),$(null),u(!0);try{await(c?P:G)(new FormData(e.target))}catch(t){$(t.message),j()}u(!1)},children:Object(y.jsxs)("fieldset",{disabled:l||!s,children:[Object(y.jsxs)("div",{className:"row",children:[Object(y.jsx)("label",{htmlFor:"input-balance",className:"label",children:"Balance"}),Object(y.jsx)("div",{className:"value",children:Object(y.jsx)("input",{id:"input-balance",disabled:!0,value:b>=0n?`${T(b)} ${d}`:""})})]}),Object(y.jsxs)("div",{className:"row",children:[Object(y.jsx)("label",{htmlFor:"input-bet",className:"label",children:"Bet"}),Object(y.jsxs)("fieldset",{className:"value group",disabled:c,children:[Object(y.jsx)("input",{ref:n,id:"input-bet",name:"bet",spellCheck:!1}),Object(y.jsx)("button",{type:"button",onClick:async function(){await F(),n.current.value=T(s.min)},children:"Min"}),Object(y.jsx)("button",{type:"button",onClick:async function(){const[e]=await Promise.all([s.getGasPrice(),F()]),t=s.balance-310000n*e;n.current.value=T(s.max<t?s.max:t)},children:"Max"})]})]}),Object(y.jsx)("div",{className:"row cards-wrapper",children:Object(y.jsx)("fieldset",{className:"cards",disabled:!c,children:x?v(x).map(((e,t)=>Object(y.jsx)(w,{index:t,value:e,flipped:g[t]},""+t+c))):Array(5).fill().map(((e,t)=>Object(y.jsx)(w,{index:t,value:0,flipped:!0},"flipped"+t)))})}),Object(y.jsx)("div",{className:"row",children:Object(y.jsx)("button",{type:"submit",id:"play-button",className:l?"loading":"",children:c?"Draw":"Deal"})}),S&&Object(y.jsx)("div",{className:"row",children:Object(y.jsxs)("div",{id:"result",children:[Object(y.jsx)("div",{children:I[S.index-1]}),Object(y.jsxs)("div",{className:"amount",children:["+",T(S.payout)," ",d]})]})}),k&&Object(y.jsx)("div",{className:"row error",children:k})]})})]})}function P({address:e}){const t=(e,t,...n)=>`#${e}${t?[t,...n].map((e=>"/"+e)).join(""):""}`;return Object(y.jsxs)("div",{className:"footer-component",children:[Object(y.jsxs)("div",{className:"links",children:[Object(y.jsx)("a",{href:t("play",e),children:"Play"}),Object(y.jsx)("a",{href:t("history",e,"1"),children:"History"}),Object(y.jsx)("a",{href:"#howtoplay",children:"How to play"})]}),Object(y.jsxs)("div",{className:"suits",children:[Object(y.jsx)("div",{className:"suit hearts"}),Object(y.jsx)("div",{className:"suit spades"}),Object(y.jsx)("div",{className:"suit diamonds"}),Object(y.jsx)("div",{className:"suit clubs"})]})]})}function A(){function e(){return window.location.hash.substr(1).split("/")}const[t,n]=Object(a.useState)(e());return Object(a.useEffect)((()=>{const t=()=>n(e());return window.addEventListener("hashchange",t),()=>window.removeEventListener("hashchange",t)})),Object(y.jsxs)(y.Fragment,{children:[Object(y.jsx)("div",{id:"title",children:"videopoker-dapp"}),Object(y.jsx)("div",{className:"app-component",children:"history"===t[0]?Object(y.jsx)(E,{address:t[1],page:t[2]}):Object(y.jsx)(G,{address:t[1],resume:t[2]})}),Object(y.jsx)(P,{address:t[1]})]})}c.a.render(Object(y.jsx)(s.a.StrictMode,{children:Object(y.jsx)(A,{})}),document.getElementById("root"))}},[[485,1,2]]]);
//# sourceMappingURL=main.ba23db8e.chunk.js.map