{"version":3,"sources":["util/contract.ts","components/ContractForm.js","assets/audio/card.mp3","assets/audio/error.mp3","assets/audio/draw.mp3","assets/audio/loss.mp3","assets/audio/win.mp3","util/audio.ts","util/const.ts","util/cards.ts","components/Cards.js","util/cache.ts","util/format.ts","components/Payouts.js","util/priceprovider.ts","components/History.js","components/ErrorMessage.js","util/activestate.ts","components/Play.js","components/Footer.js","components/App.js","index.js"],"names":["Contract","constructor","web3","address","contract","balance","min","max","call","method","args","this","methods","from","send","value","toString","event","eventName","filter","callback","provider","events","on","returnValues","off","BigInt","eth","getBalance","getGasPrice","map","id","game","state","ret","bet","cards","Number","date","Date","timestamp","change","playable","result","payout","getGames","start","searchId","Math","floor","random","Promise","success","fail","player","catch","startEvent","gameId","end","replace","endEvent","then","search","info","contracts","find","o","ContractForm","setError","setContract","first","setFirst","useState","loading","setLoading","async","handleCreateContract","window","contractAddress","chain","ethereum","request","params","chainId","e","code","Web3","abi","Error","createContract","all","updateBalance","updateMin","updateMax","message","select","res","useEffect","className","onSubmit","preventDefault","FormData","target","get","htmlFor","autoComplete","name","defaultValue","spellCheck","type","style","width","audio","src","instance","Audio","volume","currentTime","play","card","_card","error","_error","draw","_draw","loss","_loss","win","_win","WEI","Value","Suit","Results","Card","_value","_suit","jack","queen","king","ace","hearts","diamonds","clubs","spades","parse","Array","isArray","i","length","offset","parseImpl","encoded","changedToFlipped","changed","flipped","onChange","cardClick","Cards","key","localStorage","getItem","getLastBet","toBigInt","match","padEnd","SyntaxError","formatNumber","amount","formatEnd","str","slice","substr","padStart","pad2","combinations","two","three","four","five","seven","ten","deck","pad","fill","concat","Payouts","betInput","useRef","payouts","setPayouts","setBet","unit","setUnit","price","setPrice","console","warn","coingecko","promises","getPayouts","push","symbol","response","fetch","data","json","current_price","getPrice","nativeCurrency","ref","disabled","toFixed","History","page","pages","setPages","games","setGames","loaded","setLoaded","setChanged","load","getGame","some","interval","setInterval","clearInterval","reverse","ceil","location","hash","getFullYear","getMonth","getDate","getHours","getMinutes","getSeconds","href","Page","enabled","children","ErrorMessage","active","isActive","setActive","ifActive","promise","ALL_FLIPPED","NONE_FLIPPED","Play","resume","cardsWrapper","playing","setPlaying","setBalance","undefined","setCards","setFlipped","setResult","updateImpl","update","previouslyFlipped","setItem","setLastBet","handleStart","finally","input","current","querySelectorAll","checked","handleEnd","index","best","getBestBet","finished","onClick","Footer","v","join","rel","App","split","setPage","fn","addEventListener","removeEventListener","ReactDOM","render","StrictMode","document","getElementById"],"mappings":"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","file":"static/js/main.cab2fe45.chunk.js","sourcesContent":["import Web3 from \"web3\";\r\nimport { Contract as Web3Contract, EventData } from \"web3-eth-contract\";\r\nimport { abi } from \"../contracts/Videopoker.json\";\r\n\r\ninterface Game {\r\n\tid: bigint;\r\n\tbet: bigint;\r\n\tdate: Date;\r\n\tcards: number;\r\n\tchange?: number;\r\n\tresult?: number;\r\n\tpayout?: bigint;\r\n\tplayable: boolean;\r\n}\r\n\r\ninterface StartEvent {\r\n\tgameId: string;\r\n\tplayer: string;\r\n\tsearchId: string;\r\n\tcards: string;\r\n}\r\n\r\ninterface EndEvent {\r\n\tgameId: string;\r\n\tcards: string;\r\n\tresult: string;\r\n\tpayout: string;\r\n}\r\n\r\nexport class Contract {\r\n\r\n\tprivate balance = 0n;\r\n\tprivate min = 0n;\r\n\tprivate max = 0n;\r\n\r\n\tconstructor(private web3: Web3, private address: string, private contract: Web3Contract) {}\r\n\r\n\tcall(method: string, ...args: any) {\r\n\t\treturn this.contract.methods[method](...args).call({from: this.address});\r\n\t}\r\n\r\n\tsend(method: string, value: number | bigint, ...args: any) {\r\n\t\treturn this.contract.methods[method](...args).send({from: this.address, value: value.toString()});\r\n\t}\r\n\r\n\tevent<T>(eventName: string, filter: any, callback: (values: T) => any) {\r\n\t\tconst provider = this.contract.events[eventName]({ filter }).on(\"data\", (event: EventData) => {\r\n\t\t\tcallback(event.returnValues as T);\r\n\t\t\tprovider.off(\"data\");\r\n\t\t});\r\n\t}\r\n\r\n\tasync updateBalance() {\r\n\t\treturn this.balance = BigInt(await this.web3.eth.getBalance(this.address));\r\n\t}\r\n\r\n\tasync updateMin() {\r\n\t\treturn this.min = BigInt(await this.call(\"getMinBet\"));\r\n\t}\r\n\r\n\tasync updateMax() {\r\n\t\treturn this.max = BigInt(await this.call(\"getMaxBet\"));\r\n\t}\r\n\r\n\tasync getGasPrice() {\r\n\t\treturn BigInt(await this.web3.eth.getGasPrice());\r\n\t}\r\n\r\n\tasync getPayouts() {\r\n\t\treturn (await this.call(\"getPayouts\")).map(BigInt);\r\n\t}\r\n\r\n\tasync getGame(id: bigint | string): Promise<Game> {\r\n\t\tconst game = await this.call(\"getGame\", id);\r\n\t\tconst state = +game.state;\r\n\t\tconst ret = {\r\n\t\t\tid,\r\n\t\t\tbet: BigInt(game.bet),\r\n\t\t\tcards: Number(game.cards),\r\n\t\t\tdate: new Date(game.timestamp * 1000)\r\n\t\t} as Game;\r\n\t\tif(state === 0) {\r\n\t\t\t// awaiting randomness at start\r\n\t\t\tret.change = 0b11111;\r\n\t\t} else if(state === 1) {\r\n\t\t\t// game started\r\n\t\t\tret.playable = true;\r\n\t\t} else if(state === 2) {\r\n\t\t\t// awaiting randomness at end\r\n\t\t\tret.change = +game.change;\r\n\t\t} else {\r\n\t\t\t// ended\r\n\t\t\tret.result = +game.result;\r\n\t\t\tret.payout = ret.bet;\r\n\t\t}\r\n\t\treturn ret;\r\n\t}\r\n\r\n\tgetGames(): Promise<string[]> {\r\n\t\treturn this.call(\"getGames\", this.address);\r\n\t}\r\n\r\n\tstart(bet: bigint): Promise<StartEvent> {\r\n\t\tconst searchId = Math.floor(Math.random() * 4294967296);\r\n\t\treturn new Promise((success, fail) => {\r\n\t\t\tthis.event<StartEvent>(\"Start\", { searchId, player: this.address }, success);\r\n\t\t\tthis.send(\"start\", bet, searchId).catch(fail);\r\n\t\t});\r\n\t}\r\n\r\n\tstartEvent(gameId: bigint): Promise<StartEvent> {\r\n\t\treturn new Promise(success => {\r\n\t\t\tthis.event<StartEvent>(\"Start\", { gameId }, success);\r\n\t\t});\r\n\t}\r\n\r\n\tend(gameId: bigint, replace: number): Promise<EndEvent> {\r\n\t\treturn new Promise((success, fail) => {\r\n\t\t\tthis.endEvent(gameId).then(success);\r\n\t\t\tthis.send(\"end\", 0, gameId, replace).catch(fail);\r\n\t\t});\r\n\t}\r\n\r\n\tendEvent(gameId: bigint): Promise<EndEvent> {\r\n\t\treturn new Promise(success => {\r\n\t\t\tthis.event<EndEvent>(\"End\", { gameId }, success);\r\n\t\t});\r\n\t}\r\n\r\n}\r\n\r\n/**\r\n *\r\n * @param {string} contractAddress\r\n * @returns {Promise<Contract>}\r\n */\r\nexport async function createContract(contractAddress: string, chain?: any) {\r\n\t// @ts-ignore\r\n\tconst eth = window.ethereum;\r\n\tif(eth) {\r\n\t\tif(chain) {\r\n\t\t\ttry {\r\n\t\t\t\tawait eth.request({ method: \"wallet_switchEthereumChain\", params: [{ chainId: chain.chainId }]});\r\n\t\t\t} catch(e) {\r\n\t\t\t\tif(e.code === 4902) {\r\n\t\t\t\t\tawait eth.request({ method: \"wallet_addEthereumChain\", params: [ chain ]});\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthrow e;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tconst [ address ] = await eth.request({ method: \"eth_requestAccounts\" });\r\n\t\tconst web3 = new Web3(eth);\r\n\t\t// @ts-ignore\r\n\t\tconst contract = new web3.eth.Contract(abi, contractAddress);\r\n\t\treturn new Contract(web3, address, contract);\r\n\t} else {\r\n\t\tthrow new Error(\"Could not detect wallet extension\");\r\n\t}\r\n}\r\n","import { useEffect, useState } from \"react\";\r\nimport { createContract } from \"../util/contract\";\r\nimport contracts from \"../assets/contracts.json\";\r\n\r\nfunction search(address) {\r\n\tconst info = contracts.find(o => address === o.search);\r\n\treturn info ? info.address : address;\r\n}\r\n\r\nexport default function ContractForm({ address, setError, setContract }) {\r\n\r\n\tconst [ first, setFirst ] = useState(true);\r\n\tconst [ loading, setLoading ] = useState(false);\r\n\r\n\tasync function handleCreateContract(address) {\r\n\t\ttry {\r\n\t\t\t// check whether it is a well known contract\r\n\t\t\tconst info = contracts.find(o => address === o.address) || { address };\r\n\t\t\tconst contract = window.contract = await createContract(address, info.chain);\r\n\t\t\t// init balances before starting\r\n\t\t\tawait Promise.all([\r\n\t\t\t\tcontract.updateBalance(),\r\n\t\t\t\tcontract.updateMin(),\r\n\t\t\t\tcontract.updateMax()\r\n\t\t\t]);\r\n\t\t\treturn [ contract, info ];\r\n\t\t} catch(e) {\r\n\t\t\tsetFirst(true);\r\n\t\t\tsetError(e.message || \"Could not load contract\");\r\n\t\t\treturn [];\r\n\t\t}\r\n\t}\r\n\r\n\tasync function select(address) {\r\n\t\tsetError(null);\r\n\t\tsetContract(null);\r\n\t\tsetLoading(true);\r\n\t\tconst [ contract, info ] = await handleCreateContract(address);\r\n\t\tif(contract) {\r\n\t\t\tsetFirst(false);\r\n\t\t\tconst res = setContract(contract, info);\r\n\t\t\tif(res instanceof Promise) {\r\n\t\t\t\tawait res;\r\n\t\t\t}\r\n\t\t}\r\n\t\tsetLoading(false);\r\n\t}\r\n\r\n\tfunction submit(event) {\r\n\t\tevent.preventDefault();\r\n\t\tif(!first) {\r\n\t\t\t//TODO confirm change\r\n\t\t}\r\n\t\tselect(new FormData(event.target).get(\"address\"));\r\n\t}\r\n\r\n\tuseEffect(() => {\r\n\t\tif(address) {\r\n\t\t\tselect(search(address));\r\n\t\t}\r\n\t}, [address]);\r\n\r\n\treturn <form className=\"row force-margin\" onSubmit={submit}>\r\n\t\t<label htmlFor=\"input-contract\" className=\"label\">Contract</label>\r\n\t\t<div className=\"value group\">\r\n\t\t\t<input id=\"input-contract\" autoComplete=\"off\" name=\"address\" defaultValue={address ? search(address) : contracts[0].address} spellCheck={false} />\r\n\t\t\t<button type=\"submit\" className={loading ? \"loading\" : \"\"} style={{width: \"8rem\"}}>{first ? \"Use\" : \"Change\"}</button>\r\n\t\t</div>\r\n\t</form>\r\n\r\n}\r\n","export default __webpack_public_path__ + \"static/media/card.bad10dba.mp3\";","export default __webpack_public_path__ + \"static/media/error.0c2f182b.mp3\";","export default __webpack_public_path__ + \"static/media/draw.d1037966.mp3\";","export default __webpack_public_path__ + \"static/media/loss.76807f79.mp3\";","export default __webpack_public_path__ + \"static/media/win.8edc9ff0.mp3\";","import _card from \"../assets/audio/card.mp3\";\r\nimport _error from \"../assets/audio/error.mp3\";\r\nimport _draw from \"../assets/audio/draw.mp3\";\r\nimport _loss from \"../assets/audio/loss.mp3\";\r\nimport _win from \"../assets/audio/win.mp3\";\r\n\r\nfunction audio(src: string) {\r\n\tconst instance = new Audio(src);\r\n\treturn () => {\r\n\t\tinstance.volume = 1;\r\n\t\tinstance.currentTime = 0;\r\n\t\tinstance.play();\r\n\t};\r\n}\r\n\r\nexport const card = audio(_card);\r\n\r\nexport const error = audio(_error);\r\n\r\nexport const draw = audio(_draw);\r\n\r\nexport const loss = audio(_loss);\r\n\r\nexport const win = audio(_win);\r\n","export const WEI = 1000000000000000000n;\r\n\r\nexport enum Value {\r\n\ttwo = 0,\r\n\tthree,\r\n\tfour,\r\n\tfive,\r\n\tsix,\r\n\tseven,\r\n\teight,\r\n\tnine,\r\n\tten,\r\n\tjack,\r\n\tqueen,\r\n\tking,\r\n\tace\r\n}\r\n\r\nexport enum Suit {\r\n\thearts = 0b000000,\r\n\tdiamonds = 0b010000,\r\n\tclubs = 0b100000,\r\n\tspades = 0b110000\r\n}\r\n\r\nexport const Results = [\r\n\t\"Jacks or better\",\r\n\t\"Two pair\",\r\n\t\"Three of a kind\",\r\n\t\"Straight\",\r\n\t\"Flush\",\r\n\t\"Full house\",\r\n\t\"Four of a kind\",\r\n\t\"Straight flush\",\r\n\t\"Royal flush\"\r\n];\r\n","import { Value, Suit } from \"./const\";\r\n\r\nexport class Card {\r\n\r\n\tconstructor(private _value: number, private _suit: number) {}\r\n\r\n\tget value(): string {\r\n\t\tswitch(this._value) {\r\n\t\t\tcase Value.jack: return \"J\";\r\n\t\t\tcase Value.queen: return \"Q\";\r\n\t\t\tcase Value.king: return \"K\";\r\n\t\t\tcase Value.ace: return \"A\";\r\n\t\t\tdefault: return (2 + this._value).toString();\r\n\t\t}\r\n\t}\r\n\r\n\tget className(): string {\r\n\t\tswitch(this._suit) {\r\n\t\t\tcase Suit.hearts: return \"hearts\";\r\n\t\t\tcase Suit.diamonds: return \"diamonds\";\r\n\t\t\tcase Suit.clubs: return \"clubs\";\r\n\t\t\tcase Suit.spades: return \"spades\";\r\n\t\t\tdefault: return \"\";\r\n\t\t}\r\n\t}\r\n\r\n}\r\n\r\nexport function parse(cards: number | number[]): Card[] {\r\n\treturn (Array.isArray(cards) ? cards : parseImpl(cards))\r\n\t\t.map(encoded => new Card(encoded & 0b001111, encoded & 0b110000));\r\n}\r\n\r\nfunction parseImpl(cards: number): number[] {\r\n\tconst ret = Array(5);\r\n\tfor(let i=0; i<ret.length; i++) {\r\n\t\tconst offset = i * 6;\r\n\t\tret[i] = (cards & (0b111111 << offset)) >> offset;\r\n\t}\r\n\treturn ret;\r\n}\r\n\r\nexport function changedToFlipped(changed: number) {\r\n\treturn [\r\n\t\t(changed & 16) !== 0,\r\n\t\t(changed & 8) !== 0,\r\n\t\t(changed & 4) !== 0,\r\n\t\t(changed & 2) !== 0,\r\n\t\t(changed & 1) !== 0\r\n\t];\r\n}\r\n","import { card as cardClick } from \"../util/audio\";\nimport { parse } from \"../util/cards\";\nimport \"../styles/cards.scss\";\n\nfunction Card({card, name, flipped = false}){\n\treturn <div className={flipped ? \"card flipped\" : \"card\"}>\n\t\t<input id={name} type=\"checkbox\" name={name} onChange={cardClick} />\n\t\t<label htmlFor={name} className={card.className}>\n\t\t\t<span className=\"value\">{card.value}</span>\n\t\t\t<span className=\"suit\" />\n\t\t</label>\n\t</div>\n}\n\nexport default function Cards({ cards, flipped = [] }) {\n\treturn <div className=\"cards-component\">\n\t\t{parse(cards).map((card, i) => <Card key={i} card={card} name={`card${i}`} flipped={flipped[i]} />)}\n\t</div>\n}\n","function get(key: string) {\r\n\treturn window.localStorage.getItem(key);\r\n}\r\n\r\nfunction set(key: string, value: string) {\r\n\twindow.localStorage.setItem(key, value);\r\n}\r\n\r\nexport function getLastAddress() {\r\n\treturn get(\"address\");\r\n}\r\n\r\nexport function setLastAddress(address: string) {\r\n\tset(\"address\", address);\r\n}\r\n\r\nexport function getLastBet(address: string): bigint | null {\r\n\tconst bet = get(\"bet_\" + address);\r\n\treturn bet ? BigInt(bet) : null;\r\n}\r\n\r\nexport function setLastBet(address: string, bet: bigint) {\r\n\treturn window.localStorage.setItem(\"bet_\" + address, bet.toString());\r\n}\r\n","import { WEI } from \"./const\";\r\n\r\n/**\r\n * Parses a decimal number into a bigint.\r\n *\r\n * @throws {SyntaxError} When the input contains invalid characters or the format is invalid.\r\n */\r\nexport function toBigInt(value: string): bigint {\r\n\tconst match = value.match(/^(0|[1-9]\\d*)(?:\\.(\\d{1,18}))?$/);\r\n\tif(match) {\r\n\t\tif(match[2]) {\r\n\t\t\t// has a comma\r\n\t\t\treturn BigInt(match[1]) * WEI + BigInt(match[2].padEnd(18, \"0\"));\r\n\t\t} else {\r\n\t\t\treturn BigInt(value) * WEI;\r\n\t\t}\r\n\t} else {\r\n\t\tthrow new SyntaxError(\"Invalid number\");\r\n\t}\r\n}\r\n\r\n/**\r\n * Formats an integer used by the network into a decimal representation without\r\n * losing precision.\r\n */\r\nexport function formatNumber(amount: string | bigint): string {\r\n\tconst formatEnd = (str: string) => str.replace(/0+$/, \"\");\r\n\tconst str = amount.toString();\r\n\tif(str === \"0\") {\r\n\t\treturn str;\r\n\t} else if(str.length > 18) {\r\n\t\t// greater than 1 eth\r\n\t\tconst start = str.slice(0, -18);\r\n\t\tconst end = formatEnd(str.substr(str.length - 18));\r\n\t\treturn end === \"\" ? start : `${start}.${end}`;\r\n\t} else {\r\n\t\treturn `0.${formatEnd(str.padStart(18, \"0\"))}`\r\n\t}\r\n}\r\n\r\nexport function formatCurrency(value: bigint, change: number): string {\r\n\treturn (Number(value) / Number(WEI) * change).toFixed(2);\r\n}\r\n\r\nexport function formatDate(date: Date): string {\r\n\tconst year = date.getFullYear().toString().padStart(4, \"0\");\r\n\tconst month = pad2(date.getMonth() + 1);\r\n\tconst day = pad2(date.getDate());\r\n\tconst hours = pad2(date.getHours());\r\n\tconst minutes = pad2(date.getMinutes());\r\n\tconst seconds = pad2(date.getSeconds());\r\n\treturn `${year}-${month}-${day} ${hours}:${minutes}:${seconds}`;\r\n}\r\n\r\nfunction pad2(value: number): string {\r\n\treturn value.toString().padStart(2, \"0\");\r\n}\r\n","import {useRef, useState} from \"react\";\r\nimport ContractForm from \"./ContractForm\";\r\nimport Cards from \"./Cards\";\r\nimport { getLastBet } from \"../util/cache\";\r\nimport { Value, Suit, Results } from \"../util/const\";\r\nimport { formatCurrency, formatNumber, toBigInt } from \"../util/format\";\r\nimport { getPrice } from \"../util/priceprovider\";\r\nimport \"../styles/results.scss\";\r\n\r\nconst combinations = [\r\n\t[Suit.hearts | Value.jack, Suit.clubs | Value.jack],\r\n\t[Suit.clubs | Value.two, Suit.spades | Value.two, Suit.clubs | Value.king, Suit.diamonds | Value.king],\r\n\t[Suit.hearts | Value.three, Suit.diamonds | Value.three, Suit.spades | Value.three],\r\n\t[Suit.clubs | Value.ace, Suit.clubs | Value.two, Suit.spades | Value.three, Suit.hearts | Value.four, Suit.clubs | Value.five],\r\n\t[Value.seven, Value.ace, Value.king, Value.three, Value.ten],\r\n\t[Suit.hearts | Value.two, Suit.clubs | Value.two, Suit.hearts | Value.ace, Suit.clubs | Value.ace, Suit.diamonds | Value.ace],\r\n\t[Suit.hearts | Value.ace, Suit.diamonds | Value.ace, Suit.clubs | Value.ace, Suit.spades | Value.ace],\r\n\t[Value.ace, Value.two, Value.three, Value.four, Value.five],\r\n\t[Value.ten, Value.jack, Value.queen, Value.king, Value.ace]\r\n].map(deck => {\r\n\tconst pad = 5 - deck.length;\r\n\treturn {\r\n\t\tcards: Array(pad).fill(0).concat(deck),\r\n\t\tflipped: Array(pad).fill(1)\r\n\t};\r\n});\r\n\r\nexport default function Payouts({ address }) {\r\n\r\n\tconst betInput = useRef();\r\n\r\n\tconst [ payouts, setPayouts ] = useState(null);\r\n\tconst [ bet, setBet ] = useState(0n);\r\n\tconst [ unit, setUnit ] = useState(\"\");\r\n\tconst [ price, setPrice ] = useState(null);\r\n\r\n\tasync function initContract(contract, { address, chain, coingecko } = {}) {\r\n\t\tif(contract) {\r\n\t\t\tconst promises = [contract.getPayouts().then(setPayouts)];\r\n\t\t\tif(coingecko) {\r\n\t\t\t\tpromises.push(getPrice(coingecko).then(setPrice))\r\n\t\t\t}\r\n\t\t\tawait promises;\r\n\t\t\tsetBet(getLastBet(address) || 1000000000000000000n);\r\n\t\t\tsetUnit(chain?.nativeCurrency.symbol);\r\n\t\t} else {\r\n\t\t\tsetPayouts(null);\r\n\t\t}\r\n\t}\r\n\r\n\tfunction updateBet(event) {\r\n\t\ttry {\r\n\t\t\tsetBet(toBigInt(event.target.value));\r\n\t\t} catch(e) {\r\n\t\t\t//TODO mark as invalid number\r\n\t\t}\r\n\t}\r\n\r\n\treturn <div>\r\n\t\t<ContractForm address={address} setError={console.warn} setContract={initContract} />\r\n\t\t{payouts && <>\r\n\t\t\t<div className=\"row\">\r\n\t\t\t\t<label htmlFor=\"input-bet\" className=\"label\">Bet</label>\r\n\t\t\t\t<div className=\"value\">\r\n\t\t\t\t\t<input ref={betInput} id=\"input-bet\" autoComplete=\"off\" spellCheck={false} value={formatNumber(bet)} onChange={updateBet} />\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t\t<fieldset disabled>\r\n\t\t\t\t{payouts && combinations.map(({ cards, flipped }, i) => <div key={i} className=\"row results\">\r\n\t\t\t\t\t<div className=\"cards\">\r\n\t\t\t\t\t\t<Cards cards={cards} flipped={flipped} />\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div className=\"result\">\r\n\t\t\t\t\t\t<span>{bet - 1n} {payouts[i]}</span>\r\n\t\t\t\t\t\t<div>{Results[i]}</div>\r\n\t\t\t\t\t\t<div className=\"amount\">{formatNumber(bet * payouts[i])} {unit}</div>\r\n\t\t\t\t\t\t{price && <span className=\"currency\">${formatCurrency(bet * payouts[i], price)}</span>}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>)}\r\n\t\t\t</fieldset>\r\n\t\t</>}\r\n\t</div>\r\n\r\n}\r\n","export async function getPrice(symbol: string): Promise<number | null> {\r\n\ttry {\r\n\t\tconst response = await fetch(\"https://api.coingecko.com/api/v3/coins/markets?vs_currency=usd&ids=\" + symbol);\r\n\t\tconst [ data ] = await response.json();\r\n\t\treturn data.current_price;\r\n\t} catch(e) {\r\n\t\treturn null;\r\n\t}\r\n}\r\n","import { useEffect, useState } from \"react\";\r\nimport Cards from \"./Cards\";\r\nimport ContractForm from \"./ContractForm\";\r\nimport { changedToFlipped } from \"../util/cards\";\r\nimport { Results } from \"../util/const\";\r\nimport { formatDate, formatNumber } from \"../util/format\";\r\nimport \"../styles/history.scss\";\r\nimport \"../styles/results.scss\";\r\n\r\nexport default function History({ address = \"\", page = 1 }) {\r\n\r\n\tconst pageSize = 5;\r\n\r\n\tconst [ contract, setContract ] = useState(null);\r\n\tconst [ unit, setUnit ] = useState(\"\");\r\n\r\n\tconst [ pages, setPages ] = useState(null);\r\n\tconst [ games, setGames ] = useState(null);\r\n\tconst [ loaded, setLoaded ] = useState(null);\r\n\tconst [ changed, setChanged ] = useState(null);\r\n\r\n\tuseEffect(() => {\r\n\t\tif(contract && games) {\r\n\t\t\tload(contract, page - 1, games);\r\n\t\t}\r\n\t}, [page]);\r\n\r\n\tuseEffect(() => {\r\n\t\tconst interval = setInterval(() => changed && load(contract, page - 1, games), 5000);\r\n\t\treturn () => clearInterval(interval);\r\n\t});\r\n\r\n\tasync function load(contract, page, games) {\r\n\t\t// load pages from games\r\n\t\tconst i = page * pageSize;\r\n\t\tconst loaded = await Promise.all(games.slice(i, i + pageSize).map(gameId => contract.getGame(gameId)));\r\n\t\tsetChanged(loaded.some(game => game.change > 0));\r\n\t\tsetLoaded(loaded);\r\n\t}\r\n\r\n\tasync function initContract(contract, info) {\r\n\t\tif(contract) {\r\n\t\t\t// load history of played games\r\n\t\t\t//setGames(await contract.getGames());\r\n\t\t\tconst games = (await contract.getGames()).slice().reverse();\r\n\t\t\tsetGames(games);\r\n\t\t\tsetPages(Math.ceil(games.length / pageSize));\r\n\t\t\tsetUnit(info.chain?.nativeCurrency.symbol ?? \"\");\r\n\t\t\tawait load(contract, page - 1, games);\r\n\t\t\t// update hash\r\n\t\t\twindow.location.hash = `#history/${info.address}/${page}`;\r\n\t\t} else {\r\n\t\t\tsetLoaded(null);\r\n\t\t\tsetGames(null);\r\n\t\t\tsetUnit(null);\r\n\t\t}\r\n\t\tsetContract(contract);\r\n\t}\r\n\r\n\treturn <div className=\"history-component\">\r\n\t\t<ContractForm address={address} setError={console.warn} setContract={initContract} />\r\n\t\t{loaded ? (loaded.length ? <>\r\n\t\t\t<div className=\"row\">\r\n\t\t\t\t<div style={{width: \"100%\"}}>\r\n\t\t\t\t\t{loaded.map(game => <div key={game.id} className=\"history-component-game\">\r\n\t\t\t\t\t\t<div className=\"date\">{formatDate(game.date)}</div>\r\n\t\t\t\t\t\t<div className=\"results\">\r\n\t\t\t\t\t\t\t<fieldset className=\"cards\" disabled>\r\n\t\t\t\t\t\t\t\t<Cards cards={game.cards} flipped={changedToFlipped(game.change || 0)} />\r\n\t\t\t\t\t\t\t</fieldset>\r\n\t\t\t\t\t\t\t<div className=\"result\">\r\n\t\t\t\t\t\t\t\t{game.playable || game.change > 0 ? <a href={`/#play/${address}/${game.id}`}>\r\n\t\t\t\t\t\t\t\t\t<button type=\"button\">Resume</button>\r\n\t\t\t\t\t\t\t\t</a> : game.result ? <>\r\n\t\t\t\t\t\t\t\t\t<div>{Results[game.result - 1]}</div>\r\n\t\t\t\t\t\t\t\t\t<div className=\"amount\">{formatNumber(game.payout, 8)} {unit}</div>\r\n\t\t\t\t\t\t\t\t</> : \"\"}\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>)}\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t\t<div className=\"row history-component-footer\">\r\n\t\t\t\t<span>Page {page} of {pages}</span>\r\n\t\t\t\t<div className=\"spacer\" />\r\n\t\t\t\t<Page enabled={page > 1 && pages > 1} href={`#history/${address}/${page - 1}`}>&lsaquo;</Page>\r\n\t\t\t\t<Page enabled={page < pages} href={`#history/${address}/${+page + 1}`}>&rsaquo;</Page>\r\n\t\t\t</div>\r\n\t\t</> : <div className=\"history-component-empty\">You haven't played any games yet</div>) :\r\n\t\t<div className=\"history-component-empty\">Select a contract to view your playing history</div>}\r\n\t</div>\r\n\r\n}\r\n\r\nfunction Page({ enabled, href, children }) {\r\n\tif(enabled) {\r\n\t\treturn <a className=\"nav\" href={href}><button>{children}</button></a>\r\n\t} else {\r\n\t\treturn <button className=\"nav\" disabled>{children}</button>\r\n\t}\r\n}\r\n","import \"../styles/error.scss\";\r\n\r\nexport default function ErrorMessage({ error }) {\r\n\treturn <div className=\"error-component\">{ error }</div>\r\n}\r\n","const active: Record<number, boolean> = {};\r\n\r\nexport function isActive(id: number): boolean {\r\n\treturn active[id];\r\n}\r\n\r\nexport function setActive(id: number, value: boolean) {\r\n\tactive[id] = value;\r\n}\r\n\r\nexport async function ifActive<T>(id: number, promise: Promise<T>): Promise<T> {\r\n\tawait promise;\r\n\tif(!active[id]) {\r\n\t\tthrow new Error(\"Component is no longer active\");\r\n\t}\r\n\treturn promise;\r\n}\r\n","import { useEffect, useRef, useState } from \"react\";\r\nimport Cards from \"./Cards\";\r\nimport ContractForm from \"./ContractForm\";\r\nimport ErrorMessage from \"./ErrorMessage\";\r\nimport { setActive, ifActive, isActive } from \"../util/activestate\";\r\nimport * as audio from \"../util/audio\";\r\nimport { getLastBet, setLastBet } from \"../util/cache\";\r\nimport { changedToFlipped } from \"../util/cards\";\r\nimport { Results } from \"../util/const\";\r\nimport { toBigInt, formatNumber } from \"../util/format\";\r\nimport \"../styles/play.scss\";\r\n\r\nconst ALL_FLIPPED = Array(5).fill(true);\r\nconst NONE_FLIPPED = Array(5).fill(false);\r\n\r\n/**\r\n * @param {string} address\r\n * @param {number} resume\r\n * @returns {JSX.Element}\r\n */\r\nexport default function Play({ address, resume }) {\r\n\r\n\tconst bet = useRef();\r\n\tconst cardsWrapper = useRef();\r\n\r\n\tconst [ contract, setContract ] = useState(null);\r\n\r\n\tconst [ playing, setPlaying ] = useState(null);\r\n\tconst [ loading, setLoading ] = useState(false);\r\n\r\n\tconst [ unit, setUnit ] = useState(\"\");\r\n\tconst [ balance, setBalance ] = useState(undefined);\r\n\r\n\tconst [ cards, setCards ] = useState(0);\r\n\tconst [ flipped, setFlipped ] = useState(ALL_FLIPPED);\r\n\r\n\tconst [ result, setResult ] = useState(null);\r\n\tconst [ error, setError ] = useState(null);\r\n\r\n\tconst [ id ] = useState(Math.floor(Math.random() * 100000));\r\n\r\n\tuseEffect(() => {\r\n\t\tsetActive(id, true);\r\n\t\treturn () => setActive(id, false);\r\n\t}, []);\r\n\r\n\tfunction updateImpl(contract) {\r\n\t\treturn Promise.all([\r\n\t\t\tcontract.updateBalance().then(value => {\r\n\t\t\t\tsetBalance(value);\r\n\t\t\t\treturn value;\r\n\t\t\t}),\r\n\t\t\tcontract.updateMin(),\r\n\t\t\tcontract.updateMax()\r\n\t\t]);\r\n\t}\r\n\r\n\tfunction update() {\r\n\t\treturn updateImpl(contract);\r\n\t}\r\n\r\n\tfunction getBestBet(contract) {\r\n\t\tlet best = contract.balance / 10n;\r\n\t\tif(best > contract.max) best = contract.max;\r\n\t\telse if(best < contract.min) best = contract.min;\r\n\t\treturn best > contract.balance ? contract.balance : best;\r\n\t}\r\n\r\n\tasync function initContract(contract, info) {\r\n\t\tif(contract) {\r\n\t\t\tawait ifActive(id, updateImpl(contract));\r\n\t\t\tsetUnit(info.chain?.nativeCurrency.symbol ?? \"\");\r\n\t\t\t//TODO convert prices with coingecko API\r\n\t\t\t// calculate optimal bet\r\n\t\t\tbet.current.value = formatNumber(getLastBet(info.address) || getBestBet(contract));\r\n\t\t\t// update hash\r\n\t\t\twindow.location.hash = `#play/${info.address}`;\r\n\t\t\t// resume game\r\n\t\t\tif(resume) {\r\n\t\t\t\tconst game = await ifActive(id, contract.getGame(resume));\r\n\t\t\t\tconst change = game.change > 0;\r\n\t\t\t\tif(game.playable || change) {\r\n\t\t\t\t\tbet.current.value = formatNumber(game.bet);\r\n\t\t\t\t\tsetCards(game.cards);\r\n\t\t\t\t\tsetPlaying(game.id);\r\n\t\t\t\t\tif(change) {\r\n\t\t\t\t\t\tsetFlipped(changedToFlipped(game.change));\r\n\t\t\t\t\t\tsetLoading(true); // mark game as started\r\n\t\t\t\t\t\tif(!game.finished) {\r\n\t\t\t\t\t\t\thandleStart(contract.startEvent(game.id));\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\thandleEnd(contract.endEvent(game.id));\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tsetFlipped(NONE_FLIPPED);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tbet.current.value = \"\";\r\n\t\t}\r\n\t\tsetContract(contract);\r\n\t}\r\n\r\n\tasync function setMinBet() {\r\n\t\tawait update();\r\n\t\tbet.current.value = formatNumber(contract.min);\r\n\t}\r\n\r\n\tasync function setMaxBet() {\r\n\t\tconst [ price ] = await Promise.all([contract.getGasPrice(), update()]);\r\n\t\tconst balance = contract.balance - price * 500000n; // save some for fees\r\n\t\tbet.current.value = formatNumber(contract.max < balance ? contract.max : balance);\r\n\t}\r\n\r\n\tasync function start(data) {\r\n\t\tconst bet = toBigInt(data.get(\"bet\"));\r\n\t\tawait ifActive(id, update());\r\n\t\tif(bet > contract.max) {\r\n\t\t\tthrow new Error(\"Bet too high\");\r\n\t\t} else if(bet < contract.min) {\r\n\t\t\tthrow new Error(\"Bet too low\");\r\n\t\t} else if(bet > contract.balance) {\r\n\t\t\tthrow new Error(\"Insufficient balance\");\r\n\t\t} else {\r\n\t\t\tconst previouslyFlipped = flipped;\r\n\t\t\tsetFlipped(ALL_FLIPPED);\r\n\t\t\tsetResult(null);\r\n\t\t\tsetLastBet(address, bet);\r\n\t\t\tawait handleStart(contract.start(bet).finally(() => {\r\n\t\t\t\tif(isActive(id)) {\r\n\t\t\t\t\t// restore to previous game in case of cancel/fail\r\n\t\t\t\t\tsetFlipped(previouslyFlipped);\r\n\t\t\t\t}\r\n\t\t\t}));\r\n\t\t}\r\n\t}\r\n\r\n\tasync function handleStart(promise) {\r\n\t\tconst { gameId, cards } = await ifActive(id, promise);\r\n\t\t// make sure no cards are selected\r\n\t\tfor(const input of cardsWrapper.current.querySelectorAll(\":checked\")) {\r\n\t\t\tinput.checked = false;\r\n\t\t}\r\n\t\tsetCards(cards);\r\n\t\tsetFlipped(NONE_FLIPPED);\r\n\t\tsetPlaying(gameId);\r\n\t\tsetLoading(false);\r\n\t\tupdate();\r\n\t\taudio.draw();\r\n\t}\r\n\r\n\tasync function end(data) {\r\n\t\tlet replace = 0;\r\n\t\tconst flipped = [];\r\n\t\tfor(let i=0; i<5; i++) {\r\n\t\t\tif(!data.get(\"card\" + i)) {\r\n\t\t\t\treplace |= 1 << i;\r\n\t\t\t\tflipped[i] = 1;\r\n\t\t\t}\r\n\t\t}\r\n\t\tsetFlipped(flipped);\r\n\t\tawait handleEnd(contract.end(playing, replace).finally(() => {\r\n\t\t\t// all cards must be visible again when the transaction ends, is cancelled or fails\r\n\t\t\tsetFlipped(NONE_FLIPPED);\r\n\t\t}));\r\n\t}\r\n\r\n\tasync function handleEnd(promise) {\r\n\t\tconst { cards, result, payout } = await ifActive(id, promise);\r\n\t\tconst index = +result;\r\n\t\tif(index) {\r\n\t\t\tsetResult({ index, payout });\r\n\t\t\taudio.win();\r\n\t\t} else {\r\n\t\t\tsetResult(null);\r\n\t\t\taudio.loss();\r\n\t\t}\r\n\t\tsetCards(Number(BigInt(cards) & 68719476735n)); //FIXME fix event in solidity\r\n\t\tsetFlipped(NONE_FLIPPED);\r\n\t\tsetPlaying(null);\r\n\t\tsetLoading(false);\r\n\t\tupdate();\r\n\t}\r\n\r\n\tasync function submit(event) {\r\n\t\tevent.preventDefault();\r\n\t\tsetError(null);\r\n\t\tsetLoading(true);\r\n\t\ttry {\r\n\t\t\tawait (playing ? end : start)(new FormData(event.target));\r\n\t\t} catch(e) {\r\n\t\t\tif(isActive(id)) {\r\n\t\t\t\tsetError(e.message);\r\n\t\t\t\taudio.error();\r\n\t\t\t\tsetLoading(false);\r\n\t\t\t} else {\r\n\t\t\t\tconsole.warn(\"Error thrown on inactive component\", e);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tuseEffect(() => {\r\n\t\tif(contract) {\r\n\t\t\tconst interval = setInterval(update, 30000);\r\n\t\t\treturn () => clearInterval(interval);\r\n\t\t}\r\n\t}, [contract]);\r\n\r\n\treturn <div className=\"play-component\">\r\n\t\t<ContractForm address={address} setError={setError} setContract={initContract} />\r\n\t\t<form onSubmit={submit}>\r\n\t\t\t<fieldset disabled={loading || !contract}>\r\n\t\t\t\t<div className=\"row\">\r\n\t\t\t\t\t<label htmlFor=\"input-balance\" className=\"label\">Balance</label>\r\n\t\t\t\t\t<div className=\"value\">\r\n\t\t\t\t\t\t<input id=\"input-balance\" disabled={true} value={balance >= 0n ? `${formatNumber(balance)} ${unit}` : \"\"} />\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className=\"row\">\r\n\t\t\t\t\t<label htmlFor=\"input-bet\" className=\"label\">Bet</label>\r\n\t\t\t\t\t<fieldset className=\"value group\" disabled={!!playing}>\r\n\t\t\t\t\t\t<input ref={bet} id=\"input-bet\" autoComplete=\"off\" name=\"bet\" spellCheck={false} />\r\n\t\t\t\t\t\t<button type=\"button\" onClick={setMinBet}>Min</button>\r\n\t\t\t\t\t\t<button type=\"button\" onClick={setMaxBet}>Max</button>\r\n\t\t\t\t\t</fieldset>\r\n\t\t\t\t</div>\r\n\t\t\t\t<fieldset ref={cardsWrapper} className=\"row play-component-cards\" disabled={!playing}>\r\n\t\t\t\t\t<Cards cards={cards} flipped={flipped} />\r\n\t\t\t\t</fieldset>\r\n\t\t\t\t<div className=\"row\">\r\n\t\t\t\t\t<button type=\"submit\" className={`play-component-play-button${loading ? \" loading\" : \"\"}`}>\r\n\t\t\t\t\t\t{playing ? \"Draw\" : \"Deal\"}\r\n\t\t\t\t\t</button>\r\n\t\t\t\t</div>\r\n\t\t\t\t{result && <div className=\"row\">\r\n\t\t\t\t\t<div className=\"play-component-result\">\r\n\t\t\t\t\t\t<div>{Results[result.index - 1]}</div>\r\n\t\t\t\t\t\t<div className=\"amount\">+{formatNumber(result.payout)} {unit}</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>}\r\n\t\t\t\t{error && <div className=\"row\"><ErrorMessage error={error} /></div>}\r\n\t\t\t</fieldset>\r\n\t\t</form>\r\n\t</div>\r\n\r\n}\r\n","import \"../styles/footer.scss\";\r\n\r\nexport default function Footer({ address }) {\r\n\r\n\tconst ref = (name, address, ...args) => `#${name}${address ? [address, ...args].map(v => \"/\" + v).join(\"\") : \"\"}`;\r\n\r\n\treturn <div className=\"footer-component\">\r\n\t\t<div className=\"links\">\r\n\t\t\t<a href={ref(\"play\", address)}>Play</a>\r\n\t\t\t<a href={ref(\"history\", address, \"1\")}>History</a>\r\n\t\t\t<a href={ref(\"payouts\", address)}>Payouts</a>\r\n\t\t\t<a href=\"https://github.com/Kripth/videopoker-dapp/blob/master/README.md\" target=\"_blank\" rel=\"noreferrer\">About</a>\r\n\t\t\t<a href=\"https://github.com/Kripth/videopoker-dapp\" target=\"_blank\" rel=\"noreferrer\">GitHub</a>\r\n\t\t</div>\r\n\t\t<div className=\"suits\">\r\n\t\t\t<div className=\"suit hearts\" />\r\n\t\t\t<div className=\"suit spades\" />\r\n\t\t\t<div className=\"suit diamonds\" />\r\n\t\t\t<div className=\"suit clubs\" />\r\n\t\t</div>\r\n\t</div>\r\n}\r\n","import { useEffect, useState } from \"react\";\r\nimport Payouts from \"./Payouts\";\r\nimport History from \"./History\";\r\nimport Play from \"./Play\";\r\nimport Footer from \"./Footer\";\r\nimport \"../styles/app.scss\";\r\n\r\nexport default function App() {\r\n\r\n\tfunction parse() {\r\n\t\treturn window.location.hash.substr(1).split(\"/\");\r\n\t}\r\n\r\n\tconst [ page, setPage ] = useState(parse());\r\n\r\n\tuseEffect(() => {\r\n\t\tconst fn = () => setPage(parse());\r\n\t\twindow.addEventListener(\"hashchange\", fn);\r\n\t\treturn () => window.removeEventListener(\"hashchange\", fn);\r\n\t});\r\n\r\n\treturn <div className=\"app-component\">\r\n\t\t<div className=\"app-component-title\">videopoker-dapp</div>\r\n\t\t<div className=\"app-component-content\">\r\n\t\t\t{page[0] === \"history\" ?\r\n\t\t\t\t<History address={page[1]} page={page[2]} /> :\r\n\t\t\tpage[0] === \"payouts\" ?\r\n\t\t\t\t<Payouts address={page[1]} /> :\r\n\t\t\t\t<Play address={page[1]} resume={page[2]} />}\r\n\t\t</div>\r\n\t\t<Footer address={page[1]} />\r\n\t</div>\r\n\r\n}\r\n","import React from \"react\";\r\nimport ReactDOM from \"react-dom\";\r\nimport \"./styles/common.scss\";\r\nimport App from \"./components/App\";\r\n\r\nReactDOM.render(\r\n\t<React.StrictMode>\r\n\t\t<App />\r\n\t</React.StrictMode>,\r\n\tdocument.getElementById(\"root\")\r\n);\r\n"],"sourceRoot":""}