(this["webpackJsonpvideopoker-dapp"]=this["webpackJsonpvideopoker-dapp"]||[]).push([[0],{105:function(e){e.exports=JSON.parse('[{"address":"0x57c958c82e2b0ad77ff1aa63acad22a5f209951b","name":"BSC Testnet","unit":"BNB","coingecko":"binancecoin"},{"address":"0x41c356d798ea59edcf3eab146a8bec4c39155420","name":"Matic Testnet","unit":"MATIC","coingecko":"matic-network"}]')},204:function(e){e.exports=JSON.parse('[{"inputs":[],"name":"deposit","outputs":[],"stateMutability":"payable","type":"function"},{"inputs":[{"internalType":"uint256","name":"gameId","type":"uint256"},{"internalType":"uint256","name":"change","type":"uint256"}],"name":"end","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"kill","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"stateMutability":"payable","type":"constructor"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"uint256","name":"gameId","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"cards","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"result","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"payout","type":"uint256"}],"name":"End","type":"event"},{"inputs":[{"internalType":"uint256","name":"_risk","type":"uint256"}],"name":"setRisk","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"gameId","type":"uint256"}],"name":"start","outputs":[],"stateMutability":"payable","type":"function"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"uint256","name":"gameId","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"cards","type":"uint256"}],"name":"Start","type":"event"},{"inputs":[{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"withdraw","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"gameId","type":"uint256"}],"name":"getGame","outputs":[{"components":[{"internalType":"uint256","name":"bet","type":"uint256"},{"internalType":"address","name":"player","type":"address"},{"internalType":"uint64","name":"deck","type":"uint64"},{"internalType":"uint32","name":"cards","type":"uint32"}],"internalType":"struct Videopoker.Game","name":"","type":"tuple"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"player","type":"address"}],"name":"getGames","outputs":[{"internalType":"uint256[]","name":"","type":"uint256[]"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"getMaxBet","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"getMinBet","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"}]')},211:function(e,t,n){},225:function(e,t){},234:function(e,t){},252:function(e,t){},254:function(e,t){},271:function(e,t){},272:function(e,t){},337:function(e,t){},339:function(e,t){},371:function(e,t){},373:function(e,t){},374:function(e,t){},379:function(e,t){},381:function(e,t){},387:function(e,t){},389:function(e,t){},402:function(e,t){},414:function(e,t){},417:function(e,t){},422:function(e,t){},430:function(e,t){},503:function(e,t,n){"use strict";n.r(t);var a=n(11),s=n.n(a),i=n(199),c=n.n(i),r=(n(211),n(1));const l={9:"J",10:"Q",11:"K",12:"A"},u={0:"hearts",16:"diamonds",32:"clubs",48:"spades"};function d({index:e,value:t,flipped:n=!1}){const a=48&t,s=15&t,i=`card${e}`;return Object(r.jsxs)("div",{className:n?"card flipped":"card",children:[Object(r.jsx)("input",{id:i,type:"checkbox",name:i}),Object(r.jsxs)("label",{htmlFor:i,className:u[a],children:[Object(r.jsx)("span",{className:"value",children:l[s]||2+s}),Object(r.jsx)("span",{className:"suit"})]})]})}function o(e){return Array(5).fill().map(((t,n)=>{const a=6*n;return(e&63<<a)>>a}))}function j({cards:e}){return Object(r.jsx)("div",{className:"cards",children:o(e).map(((e,t)=>Object(r.jsx)(d,{index:t,value:e},t)))})}var b=n(200),p=n.n(b),h=n(204),m=1e18,y=["Jacks or better","Two pair","Three of a kind","Straight","Flush","Full house","Four of a kind","Straight flush","Royal flush"];class f{constructor(e,t,n){this.web3=e,this.address=t,this.contract=n}call(e,...t){return this.contract.methods[e](...t).call({from:this.address})}send(e,t,...n){return this.contract.methods[e](...n).send({from:this.address,value:t})}event(e,t){const n=this.contract.events[e]({filter:{gameId:this.gameId}}).on("data",(e=>{t(e.returnValues),n.off("data")}))}async updateBalance(){return this.balance=await this.web3.eth.getBalance(this.address)}async updateMin(){return this.min=+await this.call("getMinBet")}async updateMax(){return this.max=+await this.call("getMaxBet")}deposit(e){return this.send("deposit",e*m)}async getGame(e){const{bet:t,deck:n,cards:a}=await this.call("getGame",e);if(+n)return{id:e,playable:!0,bet:BigInt(t),cards:a};{const n=BigInt(t);return{id:e,result:Number(n>>252n),payout:n&2n**252n-1n,cards:a}}}getGames(){return this.call("getGames",this.address)}start(e){const t=this.gameId=function(){let e=0n;for(let t=0;t<8;t++)e|=BigInt(Math.floor(2147483648*Math.random()))<<BigInt(31*t);return e}();return new Promise(((n,a)=>{this.send("start",e,t).catch(a),this.event("Start",n)}))}end(e){return new Promise(((t,n)=>{this.send("end",0,this.gameId,e).catch(n),this.event("End",t)}))}}var x=n(105);function O({address:e,setError:t,setContract:n}){const[s,i]=Object(a.useState)(!0),[c,l]=Object(a.useState)(!1);async function u(e){const a=e.toLowerCase();t(null),n(null),l(!0);const s=await async function(e){const t=window.ethereum;if(t){await t.send("eth_requestAccounts");const n=new p.a(t),[a]=await n.eth.getAccounts(),s=new n.eth.Contract(h,e);return new f(n,a,s)}}(a);if(s){window.contract=s,await Promise.all([s.updateBalance(),s.updateMin(),s.updateMax()]),i(!1);const e=n(s,x.find((e=>a===e.address))||{address:a});e instanceof Promise&&await e}else i(!0),t("Could not load contract");l(!1)}return Object(a.useEffect)((()=>{e&&u(e)}),[e]),Object(r.jsxs)("form",{className:"row force-margin",onSubmit:function(e){e.preventDefault(),u(new FormData(e.target).get("address"))},children:[Object(r.jsx)("label",{className:"label",children:"Contract"}),Object(r.jsxs)("div",{className:"value group",children:[Object(r.jsx)("input",{name:"address",defaultValue:e||x[0].address,spellCheck:!1}),Object(r.jsx)("button",{type:"submit",className:c?"loading":"",style:{width:"8rem"},children:s?"Use":"Change"})]})]})}function v(e,t=18){if(e>m)return e/m;return`0.${e.toString().padStart(t,"0").replace(/0+$/,"").substr(0,t)}`}function w({address:e="",page:t=1}){const[n,s]=Object(a.useState)(null),[i,c]=Object(a.useState)(""),[l,u]=Object(a.useState)(null),[d,o]=Object(a.useState)(null),[b,p]=Object(a.useState)(null);async function h(e,t,n){const a=5*t;p(await Promise.all(n.slice(a,a+5).map((t=>e.getGame(t)))))}return Object(a.useEffect)((()=>{n&&d&&h(n,t-1,d)}),[t]),Object(r.jsxs)(r.Fragment,{children:[Object(r.jsx)(O,{address:e,setError:console.warn,setContract:async function(e,n){if(e){const a=(await e.getGames()).slice().reverse();o(a),u(Math.ceil(a.length/5)),c(n.unit||""),await h(e,t-1,a),window.history.replaceState({},"",`#history/${n.address}/${t}`)}else p(null),o(null),c(null);s(e)}}),Object(r.jsxs)("div",{className:"row",children:[Object(r.jsx)("label",{className:"label",children:"Order by"}),Object(r.jsx)("div",{className:"value",children:Object(r.jsxs)("select",{disabled:!0,onChange:function(e){console.log(e)},children:[Object(r.jsx)("option",{value:"desc",children:"Newest"}),Object(r.jsx)("option",{value:"asc",children:"Oldest"})]})})]}),b&&Object(r.jsxs)(r.Fragment,{children:[Object(r.jsx)("div",{className:"row",children:Object(r.jsxs)("table",{className:"history",children:[Object(r.jsx)("thead",{children:Object(r.jsxs)("tr",{children:[Object(r.jsx)("th",{children:"Cards"}),Object(r.jsx)("th",{children:"Result"})]})}),Object(r.jsx)("tbody",{children:b.map((t=>Object(r.jsxs)("tr",{children:[Object(r.jsx)("td",{children:Object(r.jsx)("fieldset",{disabled:!0,children:Object(r.jsx)(j,{cards:t.cards})})}),Object(r.jsx)("td",{className:"result",children:t.playable?Object(r.jsx)("a",{href:`/#play/${e}/${t.id}`,children:Object(r.jsx)("button",{type:"button",children:"Resume"})}):t.result?Object(r.jsxs)(r.Fragment,{children:[Object(r.jsx)("div",{children:y[t.result-1]}),Object(r.jsxs)("div",{children:[v(t.payout,10)," ",i]})]}):""})]},t.id)))})]})}),Object(r.jsxs)("div",{className:"row history-footer",children:[Object(r.jsxs)("span",{children:["Page ",t," of ",l]}),Object(r.jsx)("div",{style:{flexGrow:1}}),t>1&&l>1&&Object(r.jsx)("a",{href:`#history/${e}/${t-1}`,children:Object(r.jsx)("button",{children:"Previous"})}),t<l&&Object(r.jsx)("a",{href:`#history/${e}/${+t+1}`,children:Object(r.jsx)("button",{children:"Next"})})]})]})]})}function g({address:e,resume:t}){const n=Object(a.useRef)(),[s,i]=Object(a.useState)(null),[c,l]=Object(a.useState)(!1),[u,j]=Object(a.useState)(!1),[b,p]=Object(a.useState)(""),[h,f]=Object(a.useState)(void 0),[x,w]=Object(a.useState)(0),[g,N]=Object(a.useState)(0),[M,S]=Object(a.useState)(null),[T,k]=Object(a.useState)([]),[B,I]=Object(a.useState)(null),[$,C]=Object(a.useState)(null);function E(e){return Promise.all([e.updateBalance().then(f),e.updateMin().then(w),e.updateMax().then(N)])}function F(){return E(s)}async function G(e){const t=Math.floor(e.get("bet")*m);if(await F(),t>s.max)C("Bet too high");else if(t<s.min)C("Bet too low");else if(t>s.balance)C("Insufficient balance");else{S(null),k([]),I(null);const{cards:e}=await s.start(t);S(e),f(h-t),l(!0)}}async function P(e){let t=0;const n=[];for(let s=0;s<5;s++)e.get("card"+s)||(t|=1<<s,n[s]=1);k(n);const{cards:a,result:i,payout:c}=await s.end(t).finally((()=>{k([])})),r=+i;r?(c>0&&f(h+ +c),I({index:r,payout:c})):I(null),S(a),l(!1)}return Object(a.useEffect)((()=>{const e=setInterval((()=>s&&F()),3e4);return()=>clearInterval(e)}),[]),Object(r.jsxs)(r.Fragment,{children:[Object(r.jsx)(O,{address:e,setError:C,setContract:async function(e,a){if(e){await E(e);const{unit:s,coingecko:i}=a;p(s||"");const c=Math.min(Math.max(e.balance/10,e.min),e.max);if(n.current.value=c/m,window.history.replaceState({},"",`#play/${a.address}`),t){const a=await e.getGame(t);a.playable&&(e.gameId=a.id,n.current.value=v(a.bet),S(a.cards),l(!0))}}else n.current.value="";i(e)}}),Object(r.jsx)("form",{onSubmit:async function(e){e.preventDefault(),C(null),j(!0);try{await(c?P:G)(new FormData(e.target))}catch(t){console.warn(t.receipt),C(t.message)}j(!1)},children:Object(r.jsxs)("fieldset",{disabled:u||!s,children:[Object(r.jsxs)("div",{className:"row",children:[Object(r.jsx)("label",{className:"label",children:"Balance"}),Object(r.jsx)("div",{className:"value",children:Object(r.jsx)("input",{disabled:!0,value:h>=0?`${v(h)} ${b}`:""})})]}),Object(r.jsxs)("div",{className:"row",children:[Object(r.jsx)("label",{className:"label",children:"Bet"}),Object(r.jsxs)("div",{className:"value group",children:[Object(r.jsx)("input",{ref:n,type:"number",name:"bet",step:1e-18,min:v(x),max:v(g),disabled:c,spellCheck:!1}),Object(r.jsx)("button",{type:"button",onClick:async function(){await F(),n.current.value=v(s.min)},children:"Min"}),Object(r.jsx)("button",{type:"button",onClick:async function(){await F(),n.current.value=v(Math.min(s.max,s.balance))},children:"Max"})]})]}),Object(r.jsx)("div",{className:"row cards-wrapper",children:Object(r.jsx)("div",{className:"cards",children:M?o(M).map(((e,t)=>Object(r.jsx)(d,{index:t,value:e,flipped:T[t]},""+t+c))):Array(5).fill().map(((e,t)=>Object(r.jsx)(d,{index:t,value:0,flipped:!0},"flipped"+t)))})}),Object(r.jsx)("div",{className:"row",children:Object(r.jsx)("button",{type:"submit",id:"play-button",className:u?"loading":"",children:c?"Draw":"Deal"})}),B&&Object(r.jsx)("div",{className:"row",children:Object(r.jsxs)("div",{id:"result",children:[Object(r.jsx)("div",{children:y[B.index-1]}),Object(r.jsxs)("div",{className:"amount",children:["+",v(B.payout)," ",b]})]})}),$&&Object(r.jsx)("div",{className:"row error",children:$})]})})]})}function N({address:e}){const t=t=>`/#${t}${e?`/${e}`:""}`;return Object(r.jsxs)("div",{className:"footer-component",children:[Object(r.jsxs)("div",{className:"links",children:[Object(r.jsx)("a",{href:t("play"),children:"Play"}),Object(r.jsx)("a",{href:t("history"),children:"History"}),Object(r.jsx)("a",{href:"/#howtoplay",children:"How to play"})]}),Object(r.jsxs)("div",{className:"suits",children:[Object(r.jsx)("div",{className:"suit hearts"}),Object(r.jsx)("div",{className:"suit spades"}),Object(r.jsx)("div",{className:"suit diamonds"}),Object(r.jsx)("div",{className:"suit clubs"})]})]})}function M(){function e(){return window.location.hash.substr(1).split("/")}const[t,n]=Object(a.useState)(e());return Object(a.useEffect)((()=>{const t=()=>n(e());return window.addEventListener("hashchange",t),()=>window.removeEventListener("hashchange",t)})),Object(r.jsxs)(r.Fragment,{children:[Object(r.jsx)("div",{id:"title",children:"videopoker-dapp"}),Object(r.jsx)("div",{className:"app-component",children:"history"===t[0]?Object(r.jsx)(w,{address:t[1],page:t[2]}):Object(r.jsx)(g,{address:t[1],resume:t[2]})}),Object(r.jsx)(N,{address:t[1]})]})}c.a.render(Object(r.jsx)(s.a.StrictMode,{children:Object(r.jsx)(M,{})}),document.getElementById("root"))}},[[503,1,2]]]);
//# sourceMappingURL=main.415a359e.chunk.js.map